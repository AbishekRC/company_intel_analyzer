<!DOCTYPE html>
<html>
<head>
    <title>Analyzer Progress</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container mt-5">
    <h2>Analysis in Progress...</h2>
    <div class="progress mb-3">
        <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 0%">0%</div>
    </div>
    <p id="status-text">Starting...</p>
    <a id="download-link" href="/download" class="btn btn-success d-none">Download Results</a>

    <script>
        function updateProgress() {
            $.getJSON("/progress", function(data) {
                if (data.status === "running") {
                    let percent = 0;
                    if (data.total > 0) {
                        percent = Math.floor((data.completed / data.total) * 100);
                    }
                    $("#progress-bar").css("width", percent + "%").text(percent + "%");
                    $("#status-text").text(
                        `Completed: ${data.completed}, Failed: ${data.failed}, Total: ${data.total}`
                    );
                    setTimeout(updateProgress, 2000);
                } else if (data.status === "finished") {
                    $("#progress-bar").css("width", "100%").text("100%");
                    $("#status-text").text("Analysis finished!");
                    $("#download-link").removeClass("d-none");
                } else if (data.status.startsWith("error")) {
                    $("#status-text").text("Error: " + data.status);
                }
            });
        }
        updateProgress();
    </script>
</body>
</html>
